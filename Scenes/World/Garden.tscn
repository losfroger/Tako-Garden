[gd_scene load_steps=29 format=2]

[ext_resource path="res://Scenes/Debug/HelpConsole/DebugConsole.tscn" type="PackedScene" id=1]
[ext_resource path="res://Scenes/World/Garden.gd" type="Script" id=2]
[ext_resource path="res://Scenes/World/Objects/DebugBox.tscn" type="PackedScene" id=3]
[ext_resource path="res://Assets/Art/Background/background.png" type="Texture" id=4]
[ext_resource path="res://Scenes/UI/Configuration/MenuButton.tscn" type="PackedScene" id=5]
[ext_resource path="res://Assets/Art/Background/Sky.png" type="Texture" id=6]
[ext_resource path="res://Assets/Art/Background/Foreground.png" type="Texture" id=7]
[ext_resource path="res://Assets/Art/Background/Torii.png" type="Texture" id=8]
[ext_resource path="res://Assets/Music/InaLoadBGM.ogg" type="AudioStream" id=9]
[ext_resource path="res://Scenes/UI/TakoUI.tscn" type="PackedScene" id=10]
[ext_resource path="res://Assets/Theme/kenneyUI-yellow.tres" type="Theme" id=11]
[ext_resource path="res://Scenes/UI/ChooseMinigame.tscn" type="PackedScene" id=12]
[ext_resource path="res://Assets/Art/WhackATako/HammerImpact.png" type="Texture" id=13]
[ext_resource path="res://Assets/Particles/glowParticle.png" type="Texture" id=14]
[ext_resource path="res://Assets/Particles/Bubble.png" type="Texture" id=15]

[sub_resource type="CanvasItemMaterial" id=1]
particles_animation = true
particles_anim_h_frames = 3
particles_anim_v_frames = 1
particles_anim_loop = false

[sub_resource type="Curve" id=2]
_data = [ Vector2( 0, 0.277273 ), 0.0, 2.94231, 0, 0, Vector2( 0.788235, 0.931818 ), 0.0, 0.0, 0, 0 ]

[sub_resource type="CurveTexture" id=3]
curve = SubResource( 2 )

[sub_resource type="ParticlesMaterial" id=4]
emission_shape = 1
emission_sphere_radius = 5.0
flag_disable_z = true
direction = Vector3( 0, -5, 0 )
spread = 20.0
gravity = Vector3( 0, -49, 0 )
initial_velocity = 22.22
angular_velocity = 11.67
angular_velocity_random = 0.32
orbit_velocity = 0.0
orbit_velocity_random = 0.34
radial_accel_random = 0.08
angle = 10.6
angle_random = 1.0
scale = 0.28
scale_random = 0.56
scale_curve = SubResource( 3 )
color = Color( 1, 1, 1, 0.796078 )
anim_offset = 1.0
anim_offset_random = 1.0

[sub_resource type="Shader" id=5]
code = "/*
Shader from Godot Shaders - the free shader library.
godotshaders.com/shader/god-rays

Feel free to use, improve and change this shader according to your needs
and consider sharing the modified result on godotshaders.com.
*/

shader_type canvas_item;

uniform float angle = -0.3;
uniform float position = -0.2;
uniform float spread : hint_range(0.0, 1.0) = 0.5;
uniform float cutoff : hint_range(-1.0, 1.0) = 0.1;
uniform float falloff : hint_range(0.0, 1.0) = 0.2;
uniform float edge_fade : hint_range(0.0, 1.0) = 0.15;

uniform float speed = 1.0;
uniform float ray1_density = 8.0;
uniform float ray2_density = 30.0;
uniform float ray2_intensity : hint_range(0.0, 1.0) = 0.3;

uniform vec4 color : hint_color = vec4(1.0, 0.9, 0.65, 0.8);

uniform bool hdr = false;
uniform float seed = 5.0;

// Random and noise functions from Book of Shader's chapter on Noise.
float random(vec2 _uv) {
    return fract(sin(dot(_uv.xy,
                         vec2(12.9898, 78.233))) *
        43758.5453123);
}

float noise (in vec2 uv) {
    vec2 i = floor(uv);
    vec2 f = fract(uv);

    // Four corners in 2D of a tile
    float a = random(i);
    float b = random(i + vec2(1.0, 0.0));
    float c = random(i + vec2(0.0, 1.0));
    float d = random(i + vec2(1.0, 1.0));


    // Smooth Interpolation

    // Cubic Hermine Curve. Same as SmoothStep()
    vec2 u = f * f * (3.0-2.0 * f);

    // Mix 4 coorners percentages
    return mix(a, b, u.x) +
            (c - a)* u.y * (1.0 - u.x) +
            (d - b) * u.x * u.y;
}

mat2 rotate(float _angle){
    return mat2(vec2(cos(_angle), -sin(_angle)),
                vec2(sin(_angle), cos(_angle)));
}

vec4 screen(vec4 base, vec4 blend){
	return 1.0 - (1.0 - base) * (1.0 - blend);
}

void fragment()
{
	
	// Rotate, skew and move the UVs
	vec2 transformed_uv = ( rotate(angle) * (UV - position) )  / ( (UV.y + spread) - (UV.y * spread) );
	
	// Animate the ray according the the new transformed UVs
	vec2 ray1 = vec2(transformed_uv.x * ray1_density + sin(TIME * 0.1 * speed) * (ray1_density * 0.2) + seed, 1.0);
	vec2 ray2 = vec2(transformed_uv.x * ray2_density + sin(TIME * 0.2 * speed) * (ray1_density * 0.2) + seed, 1.0);
	
	// Cut off the ray's edges
	float cut = step(cutoff, transformed_uv.x) * step(cutoff, 1.0 - transformed_uv.x);
	ray1 *= cut;
	ray2 *= cut;
	
	// Apply the noise pattern (i.e. create the rays)
	float rays;
	
	if (hdr){
		// This is not really HDR, but check this to not clamp the two merged rays making 
		// their values go over 1.0. Can make for some nice effect
		rays = noise(ray1) + (noise(ray2) * ray2_intensity);
	}
	else{
		 rays = clamp(0., 1., noise(ray1) + (noise(ray2) * ray2_intensity));
	}
	
	// Fade out edges
	rays *= smoothstep(0.0, falloff, (1.0 - UV.y)); // Bottom
	rays *= smoothstep(0.0 + cutoff, edge_fade + cutoff, transformed_uv.x); // Left
	rays *= smoothstep(0.0 + cutoff, edge_fade + cutoff, 1.0 - transformed_uv.x); // Right
	
	// Color to the rays
	vec3 shine = vec3(rays) * color.rgb;

	// Try different blending modes for a nicer effect. \"Screen\" is included in the code,
	// but take a look at https://godotshaders.com/snippet/blending-modes/ for more.
	// With \"Screen\" blend mode:
	shine = screen(texture(SCREEN_TEXTURE, SCREEN_UV), vec4(color)).rgb;
	
	COLOR = vec4(shine, rays * color.a);
}"

[sub_resource type="ShaderMaterial" id=6]
shader = SubResource( 5 )
shader_param/angle = 0.0
shader_param/position = 0.0
shader_param/spread = 0.711
shader_param/cutoff = 0.1
shader_param/falloff = 0.2
shader_param/edge_fade = 0.15
shader_param/speed = 3.0
shader_param/ray1_density = 8.0
shader_param/ray2_density = 30.0
shader_param/ray2_intensity = 0.3
shader_param/color = Color( 0.47937, 0.807825, 0.902344, 1 )
shader_param/hdr = true
shader_param/seed = 20.0

[sub_resource type="ShaderMaterial" id=7]
shader = SubResource( 5 )
shader_param/angle = 0.1
shader_param/position = 0.2
shader_param/spread = 0.722
shader_param/cutoff = 0.1
shader_param/falloff = 0.2
shader_param/edge_fade = 0.172
shader_param/speed = 2.0
shader_param/ray1_density = 8.0
shader_param/ray2_density = 30.0
shader_param/ray2_intensity = 0.3
shader_param/color = Color( 0.47937, 0.807825, 0.902344, 1 )
shader_param/hdr = true
shader_param/seed = 50.0

[sub_resource type="Gradient" id=8]
offsets = PoolRealArray( 0.323944, 0.901408 )
colors = PoolColorArray( 0.741176, 0.901961, 0.945098, 0.376471, 1, 1, 1, 0 )

[sub_resource type="GradientTexture" id=9]
gradient = SubResource( 8 )

[sub_resource type="ParticlesMaterial" id=10]
lifetime_randomness = 0.18
emission_shape = 2
emission_box_extents = Vector3( 100, 2, 1 )
flag_rotate_y = true
flag_disable_z = true
direction = Vector3( 0, 5, 0 )
spread = 49.0
gravity = Vector3( 0, 2.5, 0 )
initial_velocity = 40.0
initial_velocity_random = 0.53
orbit_velocity = 0.0
orbit_velocity_random = 0.0
scale = 0.8
scale_random = 0.1
color_ramp = SubResource( 9 )

[sub_resource type="InputEventAction" id=11]
action = "ui_cancel"

[sub_resource type="ShortCut" id=12]
shortcut = SubResource( 11 )

[sub_resource type="Environment" id=13]
background_mode = 4
glow_enabled = true
glow_bloom = 0.03

[node name="Garden" type="Node2D"]
script = ExtResource( 2 )

[node name="ParallaxBackground" type="ParallaxBackground" parent="."]
scale = Vector2( 1.049, 1.049 )
transform = Transform2D( 1.049, 0, 0, 1.049, 0, 0 )

[node name="Sky" type="ParallaxLayer" parent="ParallaxBackground"]
motion_mirroring = Vector2( 1920, 0 )

[node name="Sky" type="Sprite" parent="ParallaxBackground/Sky"]
position = Vector2( 0, -2.14007 )
scale = Vector2( 0.5, 0.5 )
texture = ExtResource( 6 )
centered = false

[node name="Bubbles2" type="Particles2D" parent="ParallaxBackground"]
modulate = Color( 1, 1, 1, 0.329412 )
material = SubResource( 1 )
position = Vector2( 501.085, 746.341 )
amount = 3
lifetime = 15.0
preprocess = 12.0
explosiveness = 0.95
randomness = 0.38
process_material = SubResource( 4 )
texture = ExtResource( 15 )

[node name="Bubbles3" type="Particles2D" parent="ParallaxBackground"]
modulate = Color( 1, 1, 1, 0.329412 )
material = SubResource( 1 )
position = Vector2( 939.193, 726.141 )
amount = 3
lifetime = 20.0
preprocess = 15.0
explosiveness = 0.95
randomness = 0.38
process_material = SubResource( 4 )
texture = ExtResource( 15 )

[node name="Background" type="ParallaxLayer" parent="ParallaxBackground"]
motion_mirroring = Vector2( 1920, 0 )

[node name="background" type="Sprite" parent="ParallaxBackground/Background"]
position = Vector2( 0, -40.8363 )
scale = Vector2( 0.5, 0.5 )
texture = ExtResource( 4 )
centered = false

[node name="Godray" type="Sprite" parent="ParallaxBackground/Background"]
modulate = Color( 1, 1, 1, 0.160784 )
material = SubResource( 6 )
position = Vector2( 378.496, 509.147 )
scale = Vector2( 1.92808, 2.03856 )
texture = ExtResource( 13 )

[node name="Bubbles" type="Particles2D" parent="ParallaxBackground"]
modulate = Color( 1, 1, 1, 0.694118 )
material = SubResource( 1 )
position = Vector2( 1742.32, 968.907 )
amount = 5
lifetime = 20.0
preprocess = 15.0
explosiveness = 0.95
randomness = 0.27
process_material = SubResource( 4 )
texture = ExtResource( 15 )

[node name="Objects" type="ParallaxLayer" parent="ParallaxBackground"]

[node name="Sprite" type="Sprite" parent="ParallaxBackground/Objects"]
position = Vector2( 1218.53, 675.343 )
scale = Vector2( 0.5, 0.5 )
texture = ExtResource( 8 )

[node name="Foreground" type="ParallaxLayer" parent="ParallaxBackground"]
motion_mirroring = Vector2( 1920, 0 )

[node name="Sprite" type="Sprite" parent="ParallaxBackground/Foreground"]
position = Vector2( 0, 1032.15 )
scale = Vector2( 0.5, 0.5 )
texture = ExtResource( 7 )
centered = false
offset = Vector2( 0, -278 )
region_enabled = true
region_rect = Rect2( 2, 0, 5186.34, 279.332 )

[node name="Godray2" type="Sprite" parent="ParallaxBackground/Foreground"]
modulate = Color( 1, 1, 1, 0.160784 )
material = SubResource( 7 )
position = Vector2( 1449.99, 505.334 )
scale = Vector2( 1.92808, 2.03856 )
texture = ExtResource( 13 )

[node name="LightParticles" type="Particles2D" parent="."]
position = Vector2( 221.577, -31.0254 )
amount = 15
lifetime = 12.0
preprocess = 15.0
randomness = 0.69
visibility_rect = Rect2( -200, -100, 400, 200 )
process_material = SubResource( 10 )
texture = ExtResource( 14 )

[node name="LightParticles2" type="Particles2D" parent="."]
position = Vector2( 1654.14, -31.0254 )
amount = 15
lifetime = 12.0
preprocess = 15.0
randomness = 0.69
visibility_rect = Rect2( -200, -100, 400, 200 )
process_material = SubResource( 10 )
texture = ExtResource( 14 )

[node name="Takos" type="YSort" parent="."]
position = Vector2( 162.346, 92.4998 )

[node name="Food" type="Node2D" parent="."]

[node name="DebugBox" parent="." instance=ExtResource( 3 )]
position = Vector2( 0, 540 )
scale = Vector2( 1, 20 )

[node name="DebugBox2" parent="." instance=ExtResource( 3 )]
position = Vector2( 1920, 540 )
scale = Vector2( 1, 20.191 )

[node name="DebugBox3" parent="." instance=ExtResource( 3 )]
position = Vector2( 960, 1085.42 )
rotation = 1.5708
scale = Vector2( 1.92, 30 )

[node name="DebugBox4" parent="." instance=ExtResource( 3 )]
position = Vector2( 960, 0 )
rotation = 1.5708
scale = Vector2( 1, 30 )

[node name="TakoUI" parent="." instance=ExtResource( 10 )]
visible = false
position = Vector2( 924.782, 302.381 )

[node name="MusicPlayer" type="AudioStreamPlayer" parent="."]
pause_mode = 2
stream = ExtResource( 9 )
autoplay = true
bus = "Music"

[node name="UI" type="CanvasLayer" parent="."]

[node name="DebugConsole" parent="UI" instance=ExtResource( 1 )]
visible = false
theme = ExtResource( 11 )

[node name="MenuButton" parent="UI" instance=ExtResource( 5 )]
margin_left = -126.0
margin_top = 10.0
margin_right = -10.0
shortcut_in_tooltip = false
shortcut = SubResource( 12 )
pause = false

[node name="ChooseMinigame" parent="UI" instance=ExtResource( 12 )]
visible = false

[node name="AlertGLES" type="AcceptDialog" parent="UI"]
visible = true
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
margin_left = -294.5
margin_top = -209.5
margin_right = 294.5
margin_bottom = 209.5
theme = ExtResource( 11 )
popup_exclusive = true
window_title = "Driver error!"
dialog_text = "Hello I noticed that you don't have GLES3, this might be due to hardware acceleration being disabled.

This could cause some elements of the game to look incorrectly, missing entirely, or even cause performance issues. 

I recommend enabling hardware acceleration in your browser or try using the executable version of the game to fix this problem, even then I still tried to disable most of the GLES3 specific things to mitigate the problem."
dialog_autowrap = true
__meta__ = {
"_edit_use_anchors_": false
}

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource( 13 )
[connection signal="pressed" from="TakoUI/ButtonContainer/PlayButton" to="." method="_on_PlayButton_pressed"]

[editable path="TakoUI"]
